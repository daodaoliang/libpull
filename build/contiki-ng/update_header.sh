#!/bin/bash -e

#Â This script generates a header file that includes the header
# for the target platform and board

file=target_headers.h

function print_target {
    for target in `ls target`; do
        echo "#if TARGET == $target"
        for board in `ls target/$target`; do
            (cd target/$target
            dir=""
            headers=$(find $board -name '*.h')
            for header in $headers; do
                if [ x$dir == x"" ]; then
                    dir=$(dirname $header);
                    echo "#if BOARD == $dir";
                fi
                base=$(basename $header)
                echo "#include \"$target/$board/$base\""
            done
            echo "#endif"
            )
        done
        echo "#endif"
        echo ""
    done
}

cat <<EOF > $file
/********************************************************************/
/* This file is autogenerated with the update_header.sh script,     */
/* do not edit it manually.                                         */
/* It should contain the include files for the different platforms, */
/* just include it in your project and be sure to define the TARGET */
/* and BOARD preprocessor variables.                                */
/********************************************************************/

#ifndef MEMORY_HEADERS_H_
#define MEMORY_HEADERS_H_

EOF
print_target >> $file
echo "" >> $file
echo "#endif // MEMORY_HEADERS_H_" >> $file
